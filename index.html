<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í­ì‹ í­ì‹  ê³„ë‹¨ (UI ìµœì í™”)</title>
    <link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap" rel="stylesheet">
    <script src="https://clickbattle2025.web.app/click-battle.js"></script>
    <script>ClickBattle.init("SHU");</script>
    <style>
        :root {
            --bg-color: #F0F4C3;
            --primary: #FF8A65;
            --secondary: #4DD0E1;
            --ui-bg: rgba(255, 255, 255, 0.95);
            --text: #5D4037;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-color);
            font-family: 'Gamja Flower', cursive;
            touch-action: none;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: var(--text);
        }

        #game-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #fff;
            max-width: 500px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
        }

        canvas {
            flex: 1;
            width: 100%;
            background: #E0F7FA;
            cursor: pointer;
        }

        /* === HUD (ì ìˆ˜, ì½”ì¸, ìƒì ë²„íŠ¼) === */
        .hud {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            /* ìœ„ìª½ ì •ë ¬ */
            pointer-events: none;
            /* í´ë¦­ í†µê³¼ */
            z-index: 10;
        }

        .score-box {
            font-size: 28px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }

        /* ìš°ì¸¡ ìƒë‹¨ ì»¨í…Œì´ë„ˆ (ì½”ì¸ + ìƒì ë²„íŠ¼) */
        .right-hud {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
            /* ì½”ì¸ê³¼ ìƒì  ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
            pointer-events: auto;
            /* ì—¬ê¸°ëŠ” í´ë¦­ ê°€ëŠ¥í•´ì•¼ í•¨ */
        }

        .coin-box {
            font-size: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 12px;
            border-radius: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        /* ìƒì  ë²„íŠ¼ (ì½”ì¸ ë°”ë¡œ ì•„ë˜) */
        .mini-shop-btn {
            background: #8D6E63;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 5px 12px;
            font-family: 'Gamja Flower', cursive;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 3px 0 #5D4037;
            transition: transform 0.1s;
        }

        .mini-shop-btn:active {
            transform: translateY(3px);
            box-shadow: none;
        }

        /* ì»¨íŠ¸ë¡¤ ì˜ì—­ */
        .controls-area {
            height: 200px;
            background: white;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
            z-index: 20;
            padding-bottom: 50px;
            box-sizing: border-box;
        }

        .btn-game {
            width: 45%;
            height: 80px;
            border-radius: 20px;
            border: none;
            font-family: 'Gamja Flower', cursive;
            font-size: 22px;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.2);
            transition: transform 0.05s, box-shadow 0.05s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-turn {
            background-color: var(--secondary);
            box-shadow: 0 6px 0 #0097A7;
        }

        .btn-climb {
            background-color: var(--primary);
            box-shadow: 0 6px 0 #D84315;
        }

        .btn-game.pressed {
            transform: translateY(6px);
            box-shadow: none !important;
        }

        .btn-icon {
            font-size: 28px;
            margin-bottom: -2px;
        }

        /* íŒì—… ê³µí†µ */
        .popup {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
            backdrop-filter: blur(5px);
        }

        .popup-content {
            background: var(--ui-bg);
            width: 85%;
            max-width: 340px;
            padding: 25px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .hidden {
            display: none !important;
        }

        /* ê²Œì„ ì˜¤ë²„ ê²°ê³¼ì°½ (ì‹¬í”Œí•˜ê²Œ) */
        .game-over-box {
            pointer-events: none;
            /* í´ë¦­ í†µê³¼ (ìƒì  ë²„íŠ¼ ëˆ„ë¥¼ ìˆ˜ ìˆê²Œ) */
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 100%;
            z-index: 40;
            text-shadow: 2px 2px 0px #fff;
        }

        .game-over-text {
            font-size: 50px;
            color: #FF5252;
            margin: 0;
            font-weight: bold;
        }

        .game-over-score {
            font-size: 30px;
            color: #5D4037;
            margin-bottom: 20px;
        }

        /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ (ì¤‘ì•™) */
        .retry-btn {
            pointer-events: auto;
            background: #FF8A65;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 24px;
            font-family: 'Gamja Flower', cursive;
            box-shadow: 0 6px 0 #D84315;
            cursor: pointer;
            transition: 0.1s;
            margin-top: 10px;
        }

        .retry-btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        /* ìƒì  ë¦¬ìŠ¤íŠ¸ */
        .shop-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-top: 20px;
            max-height: 250px;
            overflow-y: auto;
        }

        .shop-item {
            background: #FFF8E1;
            padding: 5px;
            border-radius: 15px;
            cursor: pointer;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .shop-item.active {
            border-color: var(--primary);
            background: #FFF;
            box-shadow: 0 0 10px var(--primary);
        }

        .shop-item.locked {
            opacity: 0.5;
            filter: grayscale(1);
        }

        .shop-item-icon {
            font-size: 28px;
        }

        .shop-item-name {
            font-size: 14px;
            font-weight: bold;
            margin: 2px 0;
        }

        .shop-item-price {
            font-size: 12px;
            color: #777;
        }
    </style>
</head>

<body>

    <div id="game-wrapper">
        <div class="hud">
            <div class="score-box">ğŸ† <span id="score">0</span></div>

            <div class="right-hud">
                <div class="coin-box">ğŸ’° <span id="coins">0</span></div>
                <button class="mini-shop-btn" id="hudShopBtn" onclick="openShop()">ğŸ  ìƒì </button>
            </div>
        </div>

        <div id="gameOverLayer" class="hidden"
            style="position:absolute; width:100%; height:100%; top:0; left:0; z-index:30; background:rgba(255,255,255,0.3);">
            <div class="game-over-box">
                <h1 class="game-over-text">ì´ëŸ° ì‹¤ìˆ˜!</h1>
                <div class="game-over-score">ì ìˆ˜: <span id="finalScore">0</span></div>
                <button class="retry-btn" onclick="retryGame()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>

        <div class="controls-area">
            <button class="btn-game btn-turn" id="btnTurn">
                <span class="btn-icon">â†©ï¸</span>
                ë°©í–¥ì „í™˜
            </button>
            <button class="btn-game btn-climb" id="btnClimb">
                <span class="btn-icon">ğŸƒ</span>
                ì˜¤ë¥´ê¸°
            </button>
        </div>

        <div id="shopScreen" class="popup hidden">
            <div class="popup-content">
                <h2>ğŸ›ï¸ ìŠ¤íƒ€ì¼ ìƒì </h2>
                <p>ë³´ìœ  ì½”ì¸: <span id="shopCoins">0</span></p>
                <div class="shop-grid" id="shopList"></div>
                <button onclick="closeShop()"
                    style="background:#B0BEC5; border:none; padding:10px 30px; border-radius:30px; font-size:20px; margin-top:15px; font-family:inherit; cursor:pointer;">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let dpr = window.devicePixelRatio || 1;
        let canvasWidth, canvasHeight;

        function resize() {
            const wrapper = document.getElementById('game-wrapper');
            canvasWidth = wrapper.clientWidth;
            canvasHeight = wrapper.clientHeight - 200;
            canvas.width = canvasWidth * dpr;
            canvas.height = canvasHeight * dpr;
            ctx.scale(dpr, dpr);
            canvas.style.width = `${canvasWidth}px`;
            canvas.style.height = `${canvasHeight}px`;
            initBackground();
        }
        window.addEventListener('resize', resize);

        // ê²Œì„ ìƒíƒœ: READY(ì‹œì‘ì „), PLAYING(ê²Œì„ì¤‘), GAMEOVER(ì£½ìŒ)
        let gameState = 'READY';
        let score = 0;
        let coins = parseInt(localStorage.getItem('myCoins')) || 0;
        let bestScore = parseInt(localStorage.getItem('bestScore')) || 0;

        let player = { x: 0, y: 0, dir: 1 };
        let stairs = [];
        let cameraX = 0;
        let cameraY = 0;

        const STAIR_WIDTH = 40;
        const STAIR_HEIGHT = 30;

        // ê°€ê²© ë°”ê¾¸ëŠ” ê³³
        const skins = [
            { id: 0, icon: 'ğŸ¶', name: 'ì™€ë¦¬', price: 0, unlocked: true },
            { id: 1, icon: 'ğŸ±', name: 'ë¨ë¯¸', price: 10, unlocked: false },
            { id: 2, icon: 'ğŸ°', name: 'êºµì¶©ì´', price: 30, unlocked: false },
            { id: 3, icon: 'ğŸ¥', name: 'ëº™ì´', price: 50, unlocked: false },
            { id: 4, icon: 'ğŸ¦Š', name: 'ë½‚ìŠ¤', price: 100, unlocked: false },
            { id: 5, icon: 'ğŸ¸', name: 'ê¹¨êµ¬ë¦¬', price: 150, unlocked: false },
            { id: 6, icon: 'ğŸ·', name: 'ê¾¸êµ¬ë¦¬', price: 200, unlocked: false },
            { id: 7, icon: 'ğŸ¼', name: 'ì¿µí›„', price: 300, unlocked: false },
            { id: 8, icon: 'ğŸ¦„', name: 'ì „ì„¤ë§ˆ', price: 400, unlocked: false },
            { id: 9, icon: 'ğŸ²', name: 'ì²­ë£¡', price: 500, unlocked: false },
            { id: 10, icon: 'ğŸ‘½', name: 'ì™¹ì ¸', price: 1000, unlocked: false },
            { id: 11, icon: 'ğŸ’©', name: 'ì‘ì•„', price: 3000, unlocked: false },
        ];

        let currentSkinIdx = parseInt(localStorage.getItem('equippedSkin')) || 0;
        let unlockedSkins = JSON.parse(localStorage.getItem('unlockedSkins')) || [0];

        const els = {
            score: document.getElementById('score'),
            coins: document.getElementById('coins'),
            gameOverLayer: document.getElementById('gameOverLayer'),
            finalScore: document.getElementById('finalScore'),
            shop: document.getElementById('shopScreen'),
            shopCoins: document.getElementById('shopCoins'),
            hudShopBtn: document.getElementById('hudShopBtn')
        };
        els.coins.innerText = coins;

        let bgElements = [];
        function initBackground() {
            bgElements = [];
            for (let i = 0; i < 15; i++) {
                bgElements.push({
                    x: Math.random() * canvasWidth,
                    y: Math.random() * canvasHeight,
                    radius: Math.random() * 40 + 20,
                    speedX: (Math.random() - 0.5) * 0.5,
                    speedY: (Math.random() - 0.5) * 0.3,
                    color: `rgba(255, 255, ${Math.random() * 100 + 150}, ${Math.random() * 0.15 + 0.05})`
                });
            }
        }

        function updateAndDrawBackground() {
            let grd = ctx.createLinearGradient(0, 0, 0, canvasHeight);
            grd.addColorStop(0, "#E0F7FA");
            grd.addColorStop(1, "#FFFDE7");
            ctx.fillStyle = grd;
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);

            bgElements.forEach(el => {
                el.x += el.speedX;
                el.y += el.speedY;
                if (el.x < -el.radius) el.x = canvasWidth + el.radius;
                if (el.x > canvasWidth + el.radius) el.x = -el.radius;
                if (el.y < -el.radius) el.y = canvasHeight + el.radius;
                if (el.y > canvasHeight + el.radius) el.y = -el.radius;

                ctx.beginPath();
                ctx.arc(el.x, el.y, el.radius, 0, Math.PI * 2);
                ctx.fillStyle = el.color;
                ctx.fill();
            });
        }

        // ê²Œì„ ì´ˆê¸°í™” (ì¤€ë¹„ ìƒíƒœ)
        function initGame() {
            score = 0;
            els.score.innerText = 0;
            stairs = [];

            let cx = 0, cy = 0;
            let prevDir = 1;

            for (let i = 0; i < 50; i++) {
                addStair(cx, cy);
                if (i > 5 && Math.random() < 0.4) prevDir *= -1;
                cx += (prevDir * STAIR_WIDTH);
                cy -= STAIR_HEIGHT;
            }

            player.x = stairs[0].x - STAIR_WIDTH;
            player.y = stairs[0].y + STAIR_HEIGHT;
            player.dir = 1;
            player.idx = -1;

            cameraX = player.x;
            cameraY = player.y;

            // UI ì´ˆê¸°í™”
            els.gameOverLayer.classList.add('hidden');
            els.hudShopBtn.style.opacity = "1"; // ìƒì  ë²„íŠ¼ í™œì„±í™”
            els.hudShopBtn.style.pointerEvents = "auto";

            gameState = 'READY';
            loop();
        }

        function retryGame() {
            initGame();
        }

        function addStair(x, y) {
            let hasCoin = Math.random() < 0.1;
            let hasJewel = (!hasCoin && Math.random() < 0.02);
            stairs.push({ x, y, hasCoin, hasJewel });
        }

        function handleAction(action) {
            // ê²Œì„ ì‹œì‘ ì „ì´ë©´ ì‹œì‘
            if (gameState === 'READY') {
                gameState = 'PLAYING';
                els.hudShopBtn.style.opacity = "0.5";
                els.hudShopBtn.style.pointerEvents = "none";
            }

            if (gameState !== 'PLAYING') return;

            const nextStair = stairs[player.idx + 1];

            if (action === 'TURN') player.dir *= -1;

            let nextX = player.x + (player.dir * STAIR_WIDTH);

            // íŒì • ë¡œì§
            if (Math.abs(nextX - nextStair.x) < 5) {
                // ì„±ê³µ: ì´ë™ ë° ì ìˆ˜
                player.x = nextStair.x;
                player.y = nextStair.y;
                player.idx++;
                score++;
                els.score.innerText = score;

                // ğŸŸ¡ ì¼ë°˜ ì½”ì¸ íšë“
                if (nextStair.hasCoin) {
                    coins++;
                    nextStair.hasCoin = false;
                    els.coins.innerText = coins;
                    createParticle(player.x, player.y, "ğŸ’°", "#FFD700");
                }

                // ğŸ’ [ìˆ˜ì •ë¨] ëŒ€ë°• ë³´ì„ íšë“ ë¡œì§!
                if (nextStair.hasJewel) {
                    // 1. ë³´ìƒ ëª©ë¡ ì„¤ì •
                    const rewards = [10, 30, 50, 100];
                    // 2. ëœë¤ ë½‘ê¸°
                    const bonus = rewards[Math.floor(Math.random() * rewards.length)];

                    coins += bonus;
                    nextStair.hasJewel = false;
                    els.coins.innerText = coins;

                    // 3. ì´í™íŠ¸ (100ì½”ì¸ì€ íŠ¹ë³„í•˜ê²Œ)
                    if (bonus === 100) {
                        createParticle(player.x, player.y - 50, "ğŸ‰ëŒ€ë°•!!", "#FF4081");
                        createParticle(player.x, player.y - 20, `+${bonus}`, "#FF4081");
                    } else {
                        createParticle(player.x, player.y - 20, `+${bonus}`, "#29B6F6");
                    }
                    createParticle(player.x, player.y, "ğŸ’", "#29B6F6", 2.0);
                }

                // ë‹¤ìŒ ê³„ë‹¨ ìƒì„±
                const last = stairs[stairs.length - 1];
                let nextDir = (stairs[stairs.length - 1].x - stairs[stairs.length - 2].x) > 0 ? 1 : -1;
                if (Math.random() < 0.4) nextDir *= -1;
                addStair(last.x + (nextDir * STAIR_WIDTH), last.y - STAIR_HEIGHT);

            } else {
                gameOver();
            }
        }

        function gameOver() {
            gameState = 'GAMEOVER';
            localStorage.setItem('myCoins', coins);
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('bestScore', bestScore);
            }

            els.finalScore.innerText = score;
            els.gameOverLayer.classList.remove('hidden');

            // ê²Œì„ ì˜¤ë²„ ìƒíƒœì—ì„  ë‹¤ì‹œ ìƒì  ë²„íŠ¼ í™œì„±í™”
            els.hudShopBtn.style.opacity = "1";
            els.hudShopBtn.style.pointerEvents = "auto";
        }

        let particles = [];
        function createParticle(x, y, text, color, lifeStart = 1.0) {
            particles.push({ x, y, text, color, life: lifeStart, dy: -1.5 });
        }

        function loop() {
            if (gameState === 'PLAYING') {
                let targetCamX = player.x - (canvasWidth / 2) + (STAIR_WIDTH / 2);
                let targetCamY = player.y - (canvasHeight * 0.6);
                cameraX += (targetCamX - cameraX) * 0.1;
                cameraY += (targetCamY - cameraY) * 0.1;
            }

            draw();
            requestAnimationFrame(loop);
        }

        function draw() {
            updateAndDrawBackground();

            ctx.save();
            ctx.translate(-cameraX, -cameraY);

            const startIdx = Math.max(0, player.idx - 8);
            const endIdx = Math.min(stairs.length, player.idx + 35);

            for (let i = startIdx; i < endIdx; i++) {
                let s = stairs[i];

                // ê·¸ë¦¼ì
                ctx.fillStyle = "rgba(0,0,0,0.1)";
                ctx.fillRect(s.x + 3, s.y + 3, STAIR_WIDTH, STAIR_HEIGHT);

                // ê³„ë‹¨ ë³¸ì²´
                ctx.fillStyle = (i % 2 === 0) ? "#FFFFFF" : "#F5F5F5";
                if (i > player.idx) ctx.fillStyle = "#FFF";
                roundRect(ctx, s.x, s.y, STAIR_WIDTH, STAIR_HEIGHT, 6, true, false);

                // ì¼ë°˜ ì½”ì¸
                if (s.hasCoin) {
                    ctx.fillStyle = "#FFD700";
                    ctx.beginPath();
                    ctx.arc(s.x + STAIR_WIDTH / 2, s.y - 10, 6, 0, Math.PI * 2);
                    ctx.fill();
                }

                // ğŸ’ [ìˆ˜ì •ë¨] ë³´ì„ ê·¸ë¦¬ê¸° (ì—„ì²­ ì˜ ë³´ì´ê²Œ!)
                if (s.hasJewel) {
                    // ì‹œê°„(Date.now)ì„ ì´ìš©í•´ í¬ê¸°ê°€ ì»¤ì¡Œë‹¤ ì‘ì•„ì¡Œë‹¤ í•¨ (ì• ë‹ˆë©”ì´ì…˜)
                    const time = Date.now() / 200;
                    const scale = 1 + Math.sin(time) * 0.2; // 0.8 ~ 1.2ë°° í¬ê¸° ì§„ë™

                    ctx.save();
                    ctx.translate(s.x + STAIR_WIDTH / 2, s.y - 15); // ê³„ë‹¨ ìœ„ë¡œ ìœ„ì¹˜ ì¡ê¸°
                    ctx.scale(scale, scale); // í¬ê¸° ì¡°ì ˆ

                    // ë¹›ë‚˜ëŠ” íš¨ê³¼ (Shadow Glow)
                    ctx.shadowColor = "cyan";
                    ctx.shadowBlur = 15;

                    ctx.font = "35px Arial"; // í°íŠ¸ í¬ê¸° í‚¤ì›€
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillText("ğŸ’", 0, 0);

                    ctx.restore();
                }
            }

            // í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸°
            const skin = skins[currentSkinIdx];
            ctx.font = "30px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "bottom";

            ctx.save();
            ctx.translate(player.x + STAIR_WIDTH / 2, player.y + 5);
            ctx.scale(player.dir, 1);
            ctx.fillText(skin.icon, 0, 0);
            ctx.restore();

            // íŒŒí‹°í´(ì´í™íŠ¸ í…ìŠ¤íŠ¸) ê·¸ë¦¬ê¸°
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color || "black";
                ctx.font = "bold 20px Arial"; // ê¸€ì”¨ ì¢€ ë” êµµê²Œ
                ctx.textAlign = "center";
                ctx.fillText(p.text, p.x + STAIR_WIDTH / 2, p.y);
                p.y += p.dy;
                p.life -= 0.02; // ì²œì²œíˆ ì‚¬ë¼ì§€ê²Œ
                if (p.life <= 0) particles.splice(i, 1);
            }
            ctx.globalAlpha = 1.0;

            ctx.restore();
        }

        function roundRect(ctx, x, y, w, h, r, fill, stroke) {
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r);
            ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r);
            ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y);
            ctx.closePath();
            if (fill) ctx.fill();
            if (stroke) ctx.stroke();
        }

        const btnTurn = document.getElementById('btnTurn');
        const btnClimb = document.getElementById('btnClimb');

        function bindButton(btn, action) {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                btn.classList.add('pressed');
                handleAction(action);
            }, { passive: false });
            btn.addEventListener('touchend', (e) => {
                e.preventDefault();
                btn.classList.remove('pressed');
            });
            btn.addEventListener('mousedown', () => {
                btn.classList.add('pressed');
                handleAction(action);
            });
            btn.addEventListener('mouseup', () => btn.classList.remove('pressed'));
            btn.addEventListener('mouseleave', () => btn.classList.remove('pressed'));
        }
        bindButton(btnTurn, 'TURN');
        bindButton(btnClimb, 'CLIMB');

        window.addEventListener('keydown', (e) => {
            if (gameState === 'READY' || gameState === 'PLAYING') {
                if (e.code === 'ArrowLeft' || e.key === 'z') {
                    btnTurn.classList.add('pressed');
                    handleAction('TURN');
                }
                if (e.code === 'ArrowRight' || e.key === 'x') {
                    btnClimb.classList.add('pressed');
                    handleAction('CLIMB');
                }
            } else if (gameState === 'GAMEOVER') {
                // ê²Œì„ ì˜¤ë²„ì¼ ë•Œ í‚¤ë³´ë“œ ëˆ„ë¥´ë©´ ì¬ì‹œì‘
                if (e.code === 'ArrowLeft' || e.key === 'z' || e.code === 'ArrowRight' || e.key === 'x') {
                    retryGame();
                }
            }
        });
        window.addEventListener('keyup', () => {
            btnTurn.classList.remove('pressed');
            btnClimb.classList.remove('pressed');
        });

        // ìƒì  ë¡œì§
        function openShop() {
            els.shop.classList.remove('hidden');
            els.shopCoins.innerText = coins;
            renderShopList();
        }

        function closeShop() {
            els.shop.classList.add('hidden');
        }

        function renderShopList() {
            const list = document.getElementById('shopList');
            list.innerHTML = '';
            skins.forEach(skin => {
                const isUnlocked = unlockedSkins.includes(skin.id);
                const isEquipped = currentSkinIdx === skin.id;
                const div = document.createElement('div');
                div.className = `shop-item ${isUnlocked ? '' : 'locked'} ${isEquipped ? 'active' : ''}`;

                let statusText = isEquipped ? "ì¥ì°©ì¤‘" : (isUnlocked ? "ë³´ìœ ì¤‘" : `${skin.price} C`);

                div.innerHTML = `
                <div class="shop-item-icon">${skin.icon}</div>
                <div class="shop-item-name">${skin.name}</div>
                <div class="shop-item-price">${statusText}</div>
            `;

                div.onclick = () => {
                    if (isUnlocked) {
                        currentSkinIdx = skin.id;
                        localStorage.setItem('equippedSkin', currentSkinIdx);
                        renderShopList();
                    } else {
                        if (coins >= skin.price) {
                            if (confirm(`${skin.name} êµ¬ë§¤í• ê¹Œìš”?`)) {
                                coins -= skin.price;
                                unlockedSkins.push(skin.id);
                                localStorage.setItem('myCoins', coins);
                                localStorage.setItem('unlockedSkins', JSON.stringify(unlockedSkins));
                                els.shopCoins.innerText = coins;
                                els.coins.innerText = coins; // ë©”ì¸í™”ë©´ ì½”ì¸ë„ ê°±ì‹ 
                                renderShopList();
                            }
                        } else { alert("ì½”ì¸ì´ ë¶€ì¡±í•´ìš”!"); }
                    }
                };
                list.appendChild(div);
            });
        }

        resize();
        initGame(); 
    </script>
</body>

</html>